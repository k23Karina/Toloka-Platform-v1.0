{% extends "base.html" %}
{% block title %}–ö–∞—Ä—Ç–∞ - –¢–æ–ª–æ–∫–∞{% endblock %}
{% block content %}
<div class="container-fluid">
    <div class="page-header">
        <h1>üó∫Ô∏è –ö–∞—Ä—Ç–∞ –∑–∞–±—Ä—É–¥–Ω–µ–Ω–∏—Ö –º—ñ—Å—Ü—å</h1>
    </div>
    <div id="map-container" style="height: 600px; background: #e0e0e0; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
        <div style="text-align: center; color: #666;">
            <i class="fas fa-map fa-5x"></i>
            <p style="margin-top: 20px;">–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ –∫–∞—Ä—Ç–∞ (–¥–ª—è production –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ Leaflet –∞–±–æ Google Maps)</p>
            <p>–ó–∞–±—Ä—É–¥–Ω–µ–Ω–∏—Ö –º—ñ—Å—Ü—å: {{ polluted_places|length }}</p>
            <p>–ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ —Ç–æ–ª–æ–∫: {{ events|length }}</p>
        </div>
    </div>
    {% if current_user.is_authenticated %}
    <button class="btn btn-primary" style="margin-top: 20px;" onclick="reportPollution()">–ü–æ–≤—ñ–¥–æ–º–∏—Ç–∏ –ø—Ä–æ –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è</button>
    {% endif %}
</div>
<script>
function reportPollution() {
    const title = prompt('–ù–∞–∑–≤–∞ –º—ñ—Å—Ü—è:');
    if (!title) return;
    const lat = prompt('–®–∏—Ä–æ—Ç–∞:');
    const lng = prompt('–î–æ–≤–≥–æ—Ç–∞:');
    const severity = prompt('–†—ñ–≤–µ–Ω—å –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è (low/medium/high/critical):') || 'medium';

    fetch('/map/report', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({title, latitude: lat, longitude: lng, severity})
    }).then(() => {
        alert('–î—è–∫—É—î–º–æ –∑–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è!');
        location.reload();
    });
}
</script>
{% endblock %}