{% extends "base.html" %}

{% block title %}–ö–∞–ª–µ–Ω–¥–∞—Ä —Ç–æ–ª–æ–∫ - –¢–æ–ª–æ–∫–∞{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä —Ç–æ–ª–æ–∫</h1>
    </div>

    <div id="calendar-view"></div>

    <div class="events-list">
        <h2>–ù–∞–π–±–ª–∏–∂—á—ñ –ø–æ–¥—ñ—ó</h2>
        {% if events_json %}
            {% for event_data in events_json %}
            <div class="calendar-event-card">
                <div class="event-date-badge">
                    <div class="date-day">{{ event_data.start[:10] }}</div>
                </div>
                <div class="event-info">
                    <h3>{{ event_data.title }}</h3>
                    <p><i class="fas fa-map-marker-alt"></i> {{ event_data.location }}</p>
                    <p><i class="fas fa-clock"></i> {{ event_data.start[11:16] }}</p>
                </div>
                <a href="{{ event_data.url }}" class="btn btn-primary">–î–µ—Ç–∞–ª—å–Ω—ñ—à–µ</a>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <i class="fas fa-calendar-times fa-4x"></i>
                <p>–ù–∞–π–±–ª–∏–∂—á–∏—Ö –ø–æ–¥—ñ–π –Ω–µ–º–∞—î</p>
            </div>
        {% endif %}
    </div>
</div>

<script>
const eventsData = {{ events_json|tojson }};

// –ü—Ä–æ—Å—Ç–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä –Ω–∞ –º—ñ—Å—è—Ü—å
function renderSimpleCalendar() {
    const container = document.getElementById('calendar-view');
    const now = new Date();
    const year = now.getFullYear();
    const month = now.getMonth();

    const monthNames = ['–°—ñ—á–µ–Ω—å', '–õ—é—Ç–∏–π', '–ë–µ—Ä–µ–∑–µ–Ω—å', '–ö–≤—ñ—Ç–µ–Ω—å', '–¢—Ä–∞–≤–µ–Ω—å', '–ß–µ—Ä–≤–µ–Ω—å',
                       '–õ–∏–ø–µ–Ω—å', '–°–µ—Ä–ø–µ–Ω—å', '–í–µ—Ä–µ—Å–µ–Ω—å', '–ñ–æ–≤—Ç–µ–Ω—å', '–õ–∏—Å—Ç–æ–ø–∞–¥', '–ì—Ä—É–¥–µ–Ω—å'];

    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    let html = `<div class="calendar-header"><h2>${monthNames[month]} ${year}</h2></div>`;
    html += '<div class="calendar-grid">';
    html += '<div class="calendar-day-name">–ù–¥</div><div class="calendar-day-name">–ü–Ω</div><div class="calendar-day-name">–í—Ç</div><div class="calendar-day-name">–°—Ä</div><div class="calendar-day-name">–ß—Ç</div><div class="calendar-day-name">–ü—Ç</div><div class="calendar-day-name">–°–±</div>';

    // –ü—É—Å—Ç—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ –¥–æ –ø–æ—á–∞—Ç–∫—É –º—ñ—Å—è—Ü—è
    for (let i = 0; i < (firstDay === 0 ? 6 : firstDay - 1); i++) {
        html += '<div class="calendar-day empty"></div>';
    }

    // –î–Ω—ñ –º—ñ—Å—è—Ü—è
    for (let day = 1; day <= daysInMonth; day++) {
        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const hasEvent = eventsData.some(e => e.start.startsWith(dateStr));
        const isToday = day === now.getDate() && month === now.getMonth();

        html += `<div class="calendar-day ${hasEvent ? 'has-event' : ''} ${isToday ? 'today' : ''}">
            <span class="day-number">${day}</span>
            ${hasEvent ? '<span class="event-dot"></span>' : ''}
        </div>`;
    }

    html += '</div>';
    container.innerHTML = html;
}

renderSimpleCalendar();
</script>
{% endblock %}